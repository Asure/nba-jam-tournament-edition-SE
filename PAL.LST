TMS340 COFF Macro Assembler Version 6.10     Tue Dec 19 01:44:59 2023
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

palette allocator and fader control                                  PAGE    1

       2                            .file   "pal.asm"
       3                            .width  132
       4                            .option b,d,l,t
       5                            .mnolist
       6                    
       7                    
       8                            .include        "mproc.equ"
       9                            .include        "disp.equ"
      10                            .include        "sys.equ"
      11                            .include        "gsp.equ"
      12                            .include        "bgndtbl.glo"
      13                            .include        "imgtbl.glo"
      14                            .include        "game.equ"
      15                            .include        "shawn.hdr"
      16                    
      17                    
      18                            .ref    IRQSKYE
      19                    
      20                    
      21                    
      22                    
      23              0008  FPALNUM .equ    8
      24              1000  FPALSZ  .equ    256*16
      25                    
      26                    
      27                    
      28 00000000                   .bss    fade_start,16
      29 00000010                   .bss    fade_end,16
      30 00000020                   .bss    fade_inc,16
      31 00000030                   .bss    fade_list,32            ;list of palettes not to fade
      32                    
      33                    
      34 00000000                   BSSX    PALRAM  ,0              ;Palette allocation ram
      35 00000000                   BSSX    PALFRAM ,PALRSIZ*NMFPAL
      36 00000000                   BSSX    PALBRAM ,PALRSIZ*NMBPAL
      37 00000000                   BSSX    PALTRAM ,PALTSIZ*NUMPALT
      38                    
      39 00000000                   BSSX    FADERAM ,FPALSZ*NMFPAL  ;Fade mem for palettes
      40                    
      41 00000000                   BSSX    palfmin ,16
      42 00031260                   .bss    irqskyeo,16             ;Orignal autoerase color
      43                    
      44                    
      45              1250- morfpal1        equ     FADERAM+0*16*64
      46              1650- morfpal2        equ     FADERAM+1*16*64
      47              1a50- morfpal3        equ     FADERAM+2*16*64
      48              1e50- morfpal4        equ     FADERAM+3*16*64
      49              2250- morfpal5        equ     FADERAM+4*16*64
      50              2650- morfpal6        equ     FADERAM+5*16*64
      51              2a50- morfpal7        equ     FADERAM+6*16*64
      52              2e50- morfpal8        equ     FADERAM+7*16*64
      53              3250- morfpal9        equ     FADERAM+8*16*64
      54              3650- morfpal10       equ     FADERAM+9*16*64
      55              3a50- morfpal11       equ     FADERAM+10*16*64
      56                    
TMS340 COFF Macro Assembler Version 6.10     Tue Dec 19 01:44:59 2023
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

palette allocator and fader control                                  PAGE    2

      57                            .def    morfpal1,morfpal2
      58                            .def    morfpal3,morfpal4
      59                            .def    morfpal5,morfpal6
      60                            .def    morfpal7,morfpal8
      61                            .def    morfpal9,morfpal10
      62                            .def    morfpal11
      63                    
      64 00000000                   .text
      65                    
      66                    
      67                    
      68                    
      69 00000000            SUBR   pal_init
      70                    
      71 00000000     09e0          movi    PALRAM,a0               ;*Pal list
         00000010 00000050- 
      72 00000030     09d0          movi    PALRSIZ*NUMPAL/16,b0    ;# of words
         00000040     0060  
      73                    
      74 00000050     5621          clr     a1
      75 00000060     9020  atsvl1  move    a1,*a0+
      76 00000070     3c50          dsj     b0,atsvl1
      77                    
      78 00000080     09e0          movi    PALTRAM,a0              ;*xfer ram
         00000090 00000650- 
      79 000000b0     09d0          movi    PALTSIZ*NUMPALT/16,b0   ;# of words
         000000c0     00c0  
      80                    
      81 000000d0     9020  atsvl2  move    a1,*a0+
      82 000000e0     3c50          dsj     b0,atsvl2
      83 000000f0     0960          rets
      84                    
      85                    
      86                    
      87 00000100            SUBR   pal_clean
      88                    
      89 00000100                   PUSH    a0,a2,a3,a4
      90 00000120     09e2          movi    PALRAM+PALRSIZ,a2       ;Skip 1st pal
         00000130 00000070- 
      91                    
      92 00000150     09c3          movi    NUMPAL-1,a3             ;Chk all pals
         00000160     002f  
      93 00000170     09c4          movi    00101H,a4               ;2nd PAL #
         00000180     0101  
      94                    
      95 00000190     07a0  srnjlp  move    @OBJLST,a0,L
         000001a0 00000000! 
      96 000001c0     ca06          jrz     cp30                    ;No objs, chk backgnd
      97                    
      98 000001d0     b40e  cp20    move    *a0(OPAL),a14
         000001e0     0150  
      99 000001f0     49c4          cmp     a14,a4
     100 00000200     ca0e          jreq    cp80                    ;Used? Chk next
     101 00000210     8600          move    *a0,a0,L
     102 00000220     cbfa          jrnz    cp20
TMS340 COFF Macro Assembler Version 6.10     Tue Dec 19 01:44:59 2023
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

palette allocator and fader control                                  PAGE    3

     103                    
     104 00000230     07a0  cp30    move    @BAKLST,a0,L            ;Check in bgnd list
         00000240 00000000! 
     105 00000260     ca06          jrz     cp60                    ;No objects, clean it out
     106                    
     107 00000270     b40e  cp50    move    *a0(OPAL),a14
         00000280     0150  
     108 00000290     49c4          cmp     a14,a4
     109 000002a0     ca04          jreq    cp80                    ;Used? Chk next
     110 000002b0     8600          move    *a0,a0,L
     111 000002c0     cbfa          jrnz    cp50
     112                    
     113 000002d0           cp60
     114                    
     115 000002d0     5600  cp70    clr     a0                      ;Palette not used, free it
     116 000002e0     8202          move    a0,*a2,L
     117                    
     118 000002f0     0b04  cp80    addi    00101H,a4               ;Next pal
         00000300     0101  
     119                            .if     PAL64
     120                            btst    4,a4
     121                            jrz     cp90
     122                            addi    03030H,a4
     123                            sext    a4                      ;For compare
     124                            .endif
     125                    
     126 00000310     1002  cp90    addk    PALRSIZ,a2
     127 00000320     3f43          dsj     a3,srnjlp
     128                    
     129 00000330                   PULL    a0,a2,a3,a4
     130 00000350     0960          rets
     131                    
     132                    
     133                    
     134 00000360            SUBR   pal_find
     135                    
     136 00000360     09e1          movi    PALRAM,a1
         00000370 00000050- 
     137 00000390     09d0          movi    NUMPAL,b0
         000003a0     0030  
     138                    
     139 000003b0     962e  vzhhlp  move    *a1+,a14,L      ;Get * palette
     140 000003c0     480e          cmp     a0,a14
     141 000003d0     ca03          jreq    vzhhok          ;Found?
     142 000003e0     3c90          dsj     b0,vzhhlp
     143 000003f0     5600          clr     a0              ;Set Z
     144 00000400     0960          rets
     145                    
     146 00000410     0bf0  vzhhok  subi    NUMPAL,b0       ;Compute pal #
         00000420     ffcf  
     147 00000430     03b0          neg     b0
     148 00000440     4e11          move    b0,a1
     149                    
     150                            .if     PAL64
     151                            movk    0fH,a14
TMS340 COFF Macro Assembler Version 6.10     Tue Dec 19 01:44:59 2023
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

palette allocator and fader control                                  PAGE    4

     152                            and     a1,a14          ;A14=4 low bits
     153                            srl     4,a1            ;Move B4/B5 to B6/B7
     154                            sll     6,a1
     155                            add     a14,a1
     156                            .endif
     157                    
     158 00000450     4c20          move    a1,a0           ;Return pal #
     159 00000460     2501          sll     8,a1
     160 00000470     4020          add     a1,a0
     161 00000480     1021          addk    1,a1            ;Clr Z (OK)
     162 00000490     0960          rets
     163                    
     164                    
     165                    
     166                    
     167 000004a0            SUBR   pal_getf
     168                    
     169 000004a0                   PUSH    a2,a3
     170                    
     171 000004c0     09e1          movi    PALRAM,a1       ;0CHheck if palette already exists
         000004d0 00000050- 
     172 000004f0     09c3          movi    NUMPAL,a3
         00000500     0030  
     173 00000510     9622  gfp4    move    *a1+,a2,L       ;Get *palette
     174 00000520     4802          cmp     a0,a2
     175 00000530     ca25          jreq    getpn           ;Already in color ram?
     176 00000540     3c83          dsj     a3,gfp4
     177                    
     178 00000550     09e1          movi    PALFRAM,a1      ;0CHheck for a spare palette
         00000560 00000050- 
     179 00000580     09c3          movi    NMFPAL,a3
         00000590     0030  
     180 000005a0     9622  gfp8    move    *a1+,a2,L
     181 000005b0     ca0f          jrz     getfp           ;Palette empty? Grab it
     182 000005c0     3c63          dsj     a3,gfp8
     183                    
     184                            .if     DEBUG
     185                            .endif
     186 000005d0     0d3f          callr   pal_clean
         000005e0     ffb1  
     187                    
     188 000005f0     09e1          movi    PALFRAM,a1      ;0CHheck for a spare palette
         00000600 00000050- 
     189 00000620     09c3          movi    NMFPAL,a3
         00000630     0030  
     190 00000640     9622  gfp20   move    *a1+,a2,L
     191 00000650     ca05          jrz     getfp           ;Palette empty? Grab it
     192 00000660     3c63          dsj     a3,gfp20
     193                    
     194 00000670           ooqwerr PULL    a2,a3
     195 00000690     5600          clr     a0              ;Set Z error
     196 000006a0     0960          rets
     197                    
     198                    
     199                    
TMS340 COFF Macro Assembler Version 6.10     Tue Dec 19 01:44:59 2023
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

palette allocator and fader control                                  PAGE    5

     200                            .if     NMBPAL
     201                    
     202                     SUBR   pal_getb
     203                    
     204                            PUSH    a2,a3
     205                    
     206                            movi    PALRAM,a1       ;0CHheck if palette already exists
     207                            movi    NUMPAL,a3
     208                    gbp4    move    *a1+,a2,L       ;Get *palette
     209                            cmp     a0,a2
     210                            jreq    getpn           ;Already in color ram?
     211                            dsj     a3,gbp4
     212                    
     213                            movi    PALBRAM,a1      ;0CHheck for a spare palette
     214                            movk    NMBPAL,a3
     215                    gbp8    move    *a1+,a2,L
     216                            jrz     gbp30           ;Palette empty? Grab it
     217                            dsj     a3,gbp8
     218                    
     219                            .if     DEBUG
     220                            LOCKUP
     221                            eint
     222                            .endif
     223                            callr   pal_clean
     224                    
     225                            movi    PALBRAM,a1      ;0CHheck for a spare palette
     226                            movk    NMBPAL,a3
     227                    gbp10   move    *a1+,a2,L
     228                            jrz     gbp30           ;Palette empty? Grab it
     229                            dsj     a3,gbp10
     230                            jruc    ooqwerr
     231                    
     232                    
     233                    getfp   addk    NMBPAL,a3       ;>Setup your new palette
     234                    
     235                            .else
     236 000006b0           getfp
     237                    
     238                            .endif
     239                    
     240                    
     241 000006b0           gbp30   PUSH    a0,a1
     242 000006d0     4c61          move    a3,a1           ;Palette #
     243 000006e0     0be1          subi    NUMPAL,a1       ;Compute palette #
         000006f0     ffcf  
     244 00000700     03a1          neg     a1
     245                    
     246                            .if     PAL64
     247                            movk    0fH,a2
     248                            and     a1,a2           ;A2=4 low bits
     249                            srl     4,a1            ;Move B4/B5 to B6/B7
     250                            sll     6,a1
     251                            add     a2,a1
     252                            .endif
     253                    
TMS340 COFF Macro Assembler Version 6.10     Tue Dec 19 01:44:59 2023
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

palette allocator and fader control                                  PAGE    6

     254 00000710     2501          sll     8,a1            ;*256
     255 00000720     9402          move    *a0+,a2         ;Get # colors in pal
     256 00000730     0d3f          callr   pal_set         ;Setup pal transfer
         00000740     000e  
     257 00000750     09af          mmfm    sp,a0,a1
         00000760     0003  
     258 00000770     caef          jrz     ooqwerr         ;Failed to get transfer?
     259 00000780     a201          move    a0,-*a1,L       ;Stuff palette *
     260                    
     261 00000790     0be3  getpn   subi    NUMPAL,a3       ;Compute palette #
         000007a0     ffcf  
     262 000007b0     03a3          neg     a3
     263                    
     264                            .if     PAL64
     265                            movk    0fH,a1
     266                            and     a3,a1           ;A2=4 low bits
     267                            srl     4,a3            ;Move B4/B5 to B6/B7
     268                            sll     6,a3
     269                            add     a1,a3
     270                            .endif
     271                    
     272 000007c0     4c60          move    a3,a0           ;Return palette #
     273 000007d0     2503          sll     8,a3
     274 000007e0     4060          add     a3,a0           ;Double it up for DMA
     275                    
     276 000007f0                   PULL    a2,a3
     277 00000810     1021          addk    1,a1            ;Clr Z for OK
     278 00000820     0960          rets
     279                    
     280                    
     281                    
     282 00000830            SUBR   pal_set
     283                    
     284 00000830     4e61          move    a3,b1
     285                    
     286 00000840     09e3          movi    PALTRAM,a3
         00000850 00000650- 
     287 00000870     09d0          movi    NUMPALT,b0      ;# of palette transfers allowed
         00000880     0030  
     288                    
     289 00000890     946e  fhcklp  move    *a3+,a14
     290 000008a0     ca04          jrz     fhckset         ;Cell free?
     291 000008b0     0b03          addi    PALTSIZ-16,a3
         000008c0     0030  
     292 000008d0     3cb0          dsj     b0,fhcklp
     293                            .if     DEBUG
     294                            LOCKUP
     295                            eint
     296                            .endif
     297 000008e0     c004          jruc    fhckx
     298                    
     299 000008f0     9203  fhckset move    a0,*a3+,L       ;Set PALSRC
     300 00000900     8023          move    a1,*a3          ;Set PALDEST
     301 00000910     b043          move    a2,*a3(-48)     ;Set PLDCNT (Must set last)
         00000920     ffd0  
TMS340 COFF Macro Assembler Version 6.10     Tue Dec 19 01:44:59 2023
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

palette allocator and fader control                                  PAGE    7

     302                    
     303 00000930     4e33  fhckx   move    b1,a3
     304 00000940     4c10          move    b0,b0           ;Return Z (error) or NZ (ok)
     305 00000950     0960          rets
     306                    
     307                    
     308                    
     309                    
     310 00000960            SUBR   pal_transfer
     311                    
     312 00000960     09e0          movi    PALTRAM,a0
         00000970 00000650- 
     313 00000990     09c3          movi    NUMPALT,a3      ;# OF PALETTES
         000009a0     0030  
     314                    
     315 000009b0     56c6          clr     a6
     316 000009c0     09e7          movi    COLRAM,a7
         000009d0 01800000  
     317                    
     318 000009f0     8404  jjhglp  move    *a0,a4          ;Get count
     319 00000a00     ca18          jrz     jjhgx           ;End?
     320                    
     321 00000a10     90c0          move    a6,*a0+         ;Clear out tranfer count
     322 00000a20     9601          move    *a0+,a1,L       ;Source address
     323 00000a30     9402          move    *a0+,a2         ;Destination palette
     324 00000a40     0522          zext    a2
     325                    
     326                            .if     PAL64
     327                            move    a2,a5           ;Convert to color ram address
     328                            sll     32-12,a5
     329                            srl     32-12-4,a5      ;*16
     330                            srl     14,a2           ;Move B14/15 to B6/7
     331                            sll     6+4,a2
     332                            add     a5,a2
     333                            .else
     334 00000a50     2482          sll     4,a2            ;*16 for word addr
     335                            .endif
     336                    
     337 00000a60     40e2          add     a7,a2           ;+color ram base address
     338                    
     339 00000a70     26e4          sll     32-9,a4         ;Make 0-511
     340 00000a80     2d04          srl     32-9+1,a4
     341 00000a90     c901          jrnc    jjhg1           ;Even data count?
     342 00000aa0     9822          move    *a1+,*a2+
     343                    
     344 00000ab0     2fe4  jjhg1   srl     1,a4            ;/2 data count
     345 00000ac0     c901          jrnc    jjhg2           ;Even?
     346 00000ad0     9a22          move    *a1+,*a2+,L
     347                    
     348 00000ae0     2fe4  jjhg2   srl     1,a4            ;/2 data count
     349 00000af0     c902          jrnc    jjhg3           ;Even?
     350 00000b00     9a22          move    *a1+,*a2+,L
     351 00000b10     9a22          move    *a1+,*a2+,L
     352 00000b20     ca05  jjhg3   jrz     jjhg5           ;Cnt=0?
     353                    
TMS340 COFF Macro Assembler Version 6.10     Tue Dec 19 01:44:59 2023
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

palette allocator and fader control                                  PAGE    8

     354 00000b30     9a22  jjhg4   move    *a1+,*a2+,L
     355 00000b40     9a22          move    *a1+,*a2+,L
     356 00000b50     9a22          move    *a1+,*a2+,L
     357 00000b60     9a22          move    *a1+,*a2+,L
     358 00000b70     3ca4          dsj     a4,jjhg4
     359                    
     360 00000b80     3f43  jjhg5   dsj     a3,jjhglp
     361                    
     362 00000b90     0960  jjhgx   rets
     363                    
     364                    
     365                    
     366                    
     367 00000ba0            SUBR   pal_blacken
     368                    
     369 00000ba0                   PUSH    a2
     370                    
     371 00000bb0     0d3f          callr   pal_find
         00000bc0     ff79  
     372 00000bd0     ca10          jrz     fqjcerr
     373 00000be0     2500          sll     8,a0
     374 00000bf0     4c01          move    a0,a1
     375 00000c00     09e0          movi    FADERAM,a0
         00000c10 00001250- 
     376 00000c30     1810          movk    32,b0
     377 00000c40     5642          clr     a2
     378 00000c50     9240  fqjclp  move    a2,*a0+,L
     379 00000c60     3c50          dsj     b0,fqjclp
     380 00000c70     09e0          movi    FADERAM,a0
         00000c80 00001250- 
     381 00000ca0     09c2          movi    64,a2
         00000cb0     0040  
     382 00000cc0     0d3f          callr   pal_set
         00000cd0     ffb5  
     383                    
     384 00000ce0           fqjcerr PULL    a2
     385 00000cf0     0960          rets
     386                    
     387                    
     388                    
     389                    
     390                    
     391                    
     392                    
     393                    
     394 00000d00            SUBR   pal_fadein
     395                    
     396 00000d00     4c09          move    a0,a9           ;A9=*Palette list
     397 00000d10     4c2a          move    a1,a10          ;A10=Fade delay
     398 00000d20                   CREATE0 fadein
     399 00000d90     0960          rets
     400                    
     401 00000da0           fadein
     402 00000da0     4da6          move    a13,a6
     403 00000db0     0b06          addi    PDATA,a6
TMS340 COFF Macro Assembler Version 6.10     Tue Dec 19 01:44:59 2023
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

palette allocator and fader control                                  PAGE    9

         00000dc0     0100  
     404 00000dd0     1907          movk    FPALNUM,a7
     405                    
     406 00000de0     4d2b          move    a9,a11
     407 00000df0     9760          move    *a11+,a0,L              ;!-=Autoerase color
     408 00000e00     ce05          jrn     fi30
     409 00000e10     0580          move    a0,@irqskyeo            ;Save color
         00000e20 00031260- 
     410                    
     411 00000e40     9760  fi20    move    *a11+,a0,L              ;Get * palette
     412 00000e50     ca07          jrz     fi70                    ;0=End
     413 00000e60     0d3f  fi30    callr   pal_find
         00000e70     ff4e  
     414 00000e80     cb01          jrnz    fi60                    ;OK?
     415 00000e90     03e0          not     a0                      ;Make neg (should = -256)
     416 00000ea0     2500  fi60    sll     8,a0
     417 00000eb0     9006          move    a0,*a6+                 ;Save palette #
     418 00000ec0     3d27          dsj     a7,fi20
     419                    
     420 00000ed0     5708  fi70    clr     a8                      ;A8=Brightness
     421                    
     422                    
     423 00000ee0     1108  fi100   addk    8,a8
     424                    
     425 00000ef0     09e5          movi    FADERAM,a5
         00000f00 00001250- 
     426 00000f20     4da6          move    a13,a6
     427 00000f30     0b06          addi    PDATA,a6
         00000f40     0100  
     428 00000f50     1907          movk    FPALNUM,a7
     429                    
     430 00000f60     4d2b          move    a9,a11
     431 00000f70     8761          move    *a11,a1,L
     432 00000f80     ce04          jrn     fi200
     433 00000f90     100b          addk    32,a11
     434 00000fa0     4d02          move    a8,a2
     435 00000fb0     0d3f          callr   pal_fadeae
         00000fc0     006c  
     436                    
     437 00000fd0     9761  fi200   move    *a11+,a1,L
     438 00000fe0     ca0f          jrz     fi400                   ;End?
     439 00000ff0     4ca0          move    a5,a0
     440 00001000     4d02          move    a8,a2
     441 00001010     0d3f          callr   pal_fade
         00001020     0070  
     442 00001030     4ca0          move    a5,a0                   ;*Palette colors
     443 00001040     94c1          move    *a6+,a1                 ;Palette #
     444 00001050     0b41          cmpi    -256,a1                 ;FF00
         00001060     00ff  
     445 00001070     ca03          jreq    fi230                   ;Couldn't find?
     446 00001080     9402          move    *a0+,a2                 ;fqjcColors
     447 00001090     0d3f          callr   pal_set
         000010a0     ff78  
     448 000010b0     0b05  fi230   addi    FPALSZ,a5
         000010c0     1000  
TMS340 COFF Macro Assembler Version 6.10     Tue Dec 19 01:44:59 2023
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

palette allocator and fader control                                  PAGE   10

     449 000010d0     3e27          dsj     a7,fi200
     450                    
     451 000010e0     4d40  fi400   move    a10,a0
     452 000010f0     0d5f          calla   PRCSLP
         00001100 00000000! 
     453 00001120     0b48          cmpi    128,a8
         00001130     ff7f  
     454 00001140     c8d9          jrlo    fi100
     455                    
     456 00001150           fi800   DIE
     457                    
     458                    
     459                    
     460                    
     461                    
     462                    
     463 00001180            SUBR   pal_fadeout
     464                    
     465 00001180     574a          clr     a10
     466 00001190     058a          move    a10,@palfmin
         000011a0 00031250- 
     467                    
     468 000011c0            SUBR   pal_fadeout2
     469                    
     470 000011c0     4c09          move    a0,a9           ;A9=*Palette list
     471 000011d0     4c2a          move    a1,a10          ;A10=Fade delay
     472 000011e0                   CREATE0 fadeout
     473 00001250     0960          rets
     474                    
     475 00001260           fadeout
     476 00001260     4da6          move    a13,a6
     477 00001270     0b06          addi    PDATA,a6
         00001280     0100  
     478 00001290     1907          movk    FPALNUM,a7
     479                    
     480 000012a0     4d2b          move    a9,a11
     481 000012b0     9760          move    *a11+,a0,L              ;!-=Autoerase color
     482 000012c0     ce08          jrn     fo30
     483 000012d0     05a0          move    @IRQSKYE,a0             ;Save color
         000012e0 00000000! 
     484 00001300     0580          move    a0,@irqskyeo
         00001310 00031260- 
     485                    
     486 00001330     9760  fo20    move    *a11+,a0,L              ;Get * palette
     487 00001340     ca07          jrz     fo70                    ;0=End
     488 00001350     0d3f  fo30    callr   pal_find
         00001360     feff  
     489 00001370     cb01          jrnz    fo60
     490 00001380     03e0          not     a0                      ;Make neg
     491 00001390     2500  fo60    sll     8,a0
     492 000013a0     9006          move    a0,*a6+                 ;Save palette #
     493 000013b0     3d27          dsj     a7,fo20
     494                    
     495 000013c0     09c8  fo70    movi    128,a8                  ;A8=Brightness
         000013d0     0080  
TMS340 COFF Macro Assembler Version 6.10     Tue Dec 19 01:44:59 2023
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

palette allocator and fader control                                  PAGE   11

     496                    
     497                    
     498 000013e0     1508  fo100   subk    8,a8
     499                    
     500 000013f0     09e5          movi    FADERAM,a5
         00001400 00001250- 
     501 00001420     4da6          move    a13,a6
     502 00001430     0b06          addi    PDATA,a6
         00001440     0100  
     503 00001450     1907          movk    FPALNUM,a7
     504                    
     505 00001460     4d2b          move    a9,a11
     506 00001470     9761          move    *a11+,a1,L
     507 00001480     ce05          jrn     fo220
     508 00001490     4d02          move    a8,a2
     509 000014a0     0d3f          callr   pal_fadeae
         000014b0     001d  
     510                    
     511 000014c0     9761  fo200   move    *a11+,a1,L
     512 000014d0     ca0f          jrz     fo400
     513 000014e0     4ca0  fo220   move    a5,a0
     514 000014f0     4d02          move    a8,a2
     515 00001500     0d3f          callr   pal_fade
         00001510     0021  
     516 00001520     4ca0          move    a5,a0                   ;*Palette colors
     517 00001530     94c1          move    *a6+,a1                 ;Palette #
     518 00001540     0b41          cmpi    -256,a1                 ;FF00
         00001550     00ff  
     519 00001560     ca03          jrz     fo250
     520 00001570     9402          move    *a0+,a2                 ;fqjcColors
     521 00001580     0d3f          callr   pal_set
         00001590     ff29  
     522 000015a0     0b05  fo250   addi    FPALSZ,a5
         000015b0     1000  
     523 000015c0     3e27          dsj     a7,fo200
     524                    
     525 000015d0     4d40  fo400   move    a10,a0
     526 000015e0     0d5f          calla   PRCSLP
         000015f0 00000000! 
     527 00001610     05a0          move    @palfmin,a0
         00001620 00031250- 
     528 00001640     4808          cmp     a0,a8
     529 00001650     c7d8          jrgt    fo100
     530                    
     531 00001660           fo800   DIE
     532                    
     533                    
     534                    
     535 00001690            SUBRP  pal_fadeae      ;A2=Brightness (0-128)
     536                    
     537 00001690                   PUSH    a3,a5,a7,a8
     538                    
     539 000016b0     09e0          movi    IRQSKYE,a0
         000016c0 00000000! 
     540 000016e0     09e1          movi    irqskyeo,a1
TMS340 COFF Macro Assembler Version 6.10     Tue Dec 19 01:44:59 2023
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

palette allocator and fader control                                  PAGE   12

         000016f0 00031260- 
     541 00001710     182e          movk    1,a14
     542 00001720     c006          jruc    pf1c
     543                    
     544                    
     545                    
     546 00001730            SUBRP  pal_fade
     547                    
     548 00001730                   PUSH    a3,a5,a7,a8
     549                    
     550 00001750     942e          move    *a1+,a14        ;# Colors
     551 00001760     91c0          move    a14,*a0+
     552                    
     553 00001770     26ee          sll     32-9,a14        ;Remove any flags
     554 00001780     2d2e          srl     32-9,a14        ;9 bits needed for # colors
     555                    
     556 00001790     1be8  pf1c    movk    01fH,a8         ;A8=5 bit color mask
     557                    
     558 000017a0     9423  pf100   move    *a1+,a3
     559 000017b0     1be7          movk    01fH,a7
     560 000017c0     5067          and     a3,a7           ;A7=Blue
     561 000017d0     2f63          srl     5,a3
     562 000017e0     1be5          movk    01fH,a5
     563 000017f0     5065          and     a3,a5           ;A5=Green
     564 00001800     2f63          srl     5,a3            ;A3=Red
     565                    
     566 00001810     5e43          mpyu    a2,a3
     567 00001820     5e45          mpyu    a2,a5
     568 00001830     5e47          mpyu    a2,a7
     569 00001840     2f23          srl     7,a3            ;/128
     570 00001850     2f25          srl     7,a5
     571 00001860     2f27          srl     7,a7
     572                    
     573 00001870     4903          cmp     a8,a3
     574 00001880     c201          jrls    pfrok
     575 00001890     4d03          move    a8,a3
     576                    
     577 000018a0     4905  pfrok   cmp     a8,a5
     578 000018b0     c201          jrls    pfgok
     579 000018c0     4d05          move    a8,a5
     580                    
     581 000018d0     4907  pfgok   cmp     a8,a7
     582 000018e0     c201          jrls    pfbok
     583 000018f0     4d07          move    a8,a7
     584                    
     585 00001900     2543  pfbok   sll     10,a3
     586 00001910     24a5          sll     5,a5
     587 00001920     54a3          or      a5,a3
     588 00001930     54e3          or      a7,a3
     589 00001940     9060          move    a3,*a0+         ;Save color
     590 00001950     3f8e          dsj     a14,pf100
     591                    
     592 00001960                   PULL    a3,a5,a7,a8
     593 00001980     0960          rets
     594                    
TMS340 COFF Macro Assembler Version 6.10     Tue Dec 19 01:44:59 2023
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

palette allocator and fader control                                  PAGE   13

     595                    
     596                    
     597                    
     598 00001990            SUBR   pal_fadeinx
     599                    
     600 00001990                   PUSH    a2,a6,a7,a8,a9,a10
     601 000019b0     190a          movk    8,a10
     602 000019c0     c004          jruc    fbf10
     603                    
     604                    
     605                    
     606 000019d0            SUBR   pal_fadeoutx
     607                    
     608 000019d0                   PUSH    a2,a6,a7,a8,a9,a10
     609 000019f0     09ca          movi    -8,a10
         00001a00     fff8  
     610                    
     611 00001a10     4c06  fbf10   move    a0,a6
     612                                                            ;Start proc to fade each palette
     613 00001a20     5729          clr     a9                      ;palette slot
     614 00001a30     09e2          movi    PALRAM,a2               ;A2=*Palette table
         00001a40 00000050- 
     615                    
     616 00001a60     9648  fbf20   move    *a2+,a8,L               ;Ptr to palette
     617 00001a70     ca0e          jrz     fbf70
     618 00001a80     4cc7          move    a6,a7                   ;A6=*List of palettes to skip
     619 00001a90     ca05          jrz     fbf60
     620                    
     621 00001aa0     96e1  fbf50   move    *a7+,a1,L
     622 00001ab0     ca03          jrz     fbf60
     623 00001ac0     4828          cmp     a1,a8
     624 00001ad0     ca08          jreq    fbf70                   ;Skip pal?
     625 00001ae0     c0fb          jruc    fbf50
     626                    
     627 00001af0           fbf60   CREATE0 fadeonep
     628                    
     629 00001b60     1029  fbf70   addk    1,a9
     630 00001b70     0b49          cmpi    NUMPAL,a9
         00001b80     ffcf  
     631 00001b90     c4ec          jrlt    fbf20
     632                    
     633 00001ba0           fbfx    PULL    a2,a6,a7,a8,a9,a10
     634 00001bc0     0960          rets
     635                    
     636                    
     637                    
     638 00001bd0           fadeonep
     639                    
     640                            .if     PAL64
     641                            movk    0fH,a2
     642                            and     a9,a2           ;A2=4 low bits
     643                            srl     4,a9            ;Move B4/B5 to B6/B7
     644                            sll     6,a9
     645                            add     a2,a9
     646                            .endif
TMS340 COFF Macro Assembler Version 6.10     Tue Dec 19 01:44:59 2023
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

palette allocator and fader control                                  PAGE   14

     647                    
     648 00001bd0     2509          sll     8,a9            ;B8-15 dest pal, B0-7 color (0)
     649                    
     650 00001be0     576b          clr     a11             ;For up fade
     651 00001bf0     4d4a          move    a10,a10
     652 00001c00     c714          jrgt    fop60
     653 00001c10     09cb          movi    128,a11         ;For dn fade
         00001c20     0080  
     654 00001c30     c011          jruc    fop60
     655                                                    ;>Set up faded pal in process data space
     656 00001c40           foplp
     657 00001c40     4d62          move    a11,a2          ;A2=Color Multiplier
     658 00001c50     4da0          move    a13,a0
     659 00001c60     0b00          addi    PDATA,a0        ;A0=Dest Ram for Pal
         00001c70     0100  
     660 00001c80     4c05          move    a0,a5
     661 00001c90     4d01          move    a8,a1           ;A1=Src for Pal
     662 00001ca0     0d3f          callr   pal_fade
         00001cb0     ffa7  
     663                    
     664 00001cc0     4ca0          move    a5,a0           ;>Move faded palette to palram
     665 00001cd0     4d21          move    a9,a1
     666 00001ce0     9402          move    *a0+,a2         ;Get # colors in palette
     667 00001cf0     0d3f          callr   pal_set         ;Set transfer
         00001d00     feb2  
     668                    
     669 00001d10                   SLEEPK  2
     670 00001d50     414b  fop60   add     a10,a11
     671 00001d60     0b4b          cmpi    128,a11
         00001d70     ff7f  
     672 00001d80     c2eb          jrls    foplp
     673                    
     674                    
     675 00001d90                   SLEEPK  2               ;Wait on last pal_set
     676 00001dd0                   DIE
     677                    
     678                    
     679                    
     680 00001e00            SUBR   pal_fmwht
     681                    
     682 00001e00                   PUSH    a2,a6,a7,a8,a9,a10
     683 00001e20     09ca          movi    -1,a10
         00001e30     ffff  
     684 00001e40     c009          jruc    ptw10
     685                    
     686                    
     687                    
     688 00001e50            SUBR   pal_towht
     689                    
     690 00001e50                   PUSH    a2,a6,a7,a8,a9,a10
     691 00001e70     05a2          move    @IRQSKYE,a2             ;Save color
         00001e80 00000000! 
     692 00001ea0     0582          move    a2,@irqskyeo
         00001eb0 00031260- 
     693 00001ed0     182a          movk    1,a10
TMS340 COFF Macro Assembler Version 6.10     Tue Dec 19 01:44:59 2023
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

palette allocator and fader control                                  PAGE   15

     694                    
     695 00001ee0     4c06  ptw10   move    a0,a6
     696 00001ef0     4c21          move    a1,a1
     697 00001f00     ca07          jrz     ptw15                   ;Skip AE
     698 00001f10                   CREATE0 addbrt_ae
     699                                                            ;Start proc to fade each palette
     700 00001f80     5729  ptw15   clr     a9                      ;palette slot
     701 00001f90     09e2          movi    PALRAM,a2               ;A2=*Palette table
         00001fa0 00000050- 
     702                    
     703 00001fc0     9648  ptw20   move    *a2+,a8,L               ;Ptr to palette
     704 00001fd0     ca0e          jrz     ptw70
     705 00001fe0     4cc7          move    a6,a7                   ;A6=*List of palettes to skip
     706 00001ff0     ca05          jrz     ptw60
     707                    
     708 00002000     96e1  ptw50   move    *a7+,a1,L
     709 00002010     ca03          jrz     ptw60
     710 00002020     4828          cmp     a1,a8
     711 00002030     ca08          jreq    ptw70                   ;Skip pal?
     712 00002040     c0fb          jruc    ptw50
     713                    
     714 00002050           ptw60   CREATE0 brightenonep
     715                    
     716 000020c0     1029  ptw70   addk    1,a9
     717 000020d0     0b49          cmpi    NUMPAL,A9
         000020e0     ffcf  
     718 000020f0     c4ec          jrlt    ptw20
     719                    
     720 00002100           ptwx    PULL    a2,a6,a7,a8,a9,a10
     721 00002120     0960          rets
     722                    
     723                    
     724                    
     725 00002130           brightenonep
     726                            .if     PAL64
     727                            movk    0fH,a2
     728                            and     a9,a2           ;A2=4 low bits
     729                            srl     4,a9            ;Move B4/B5 to B6/B7
     730                            sll     6,a9
     731                            add     a2,a9
     732                            .endif
     733                    
     734 00002130     2509          sll     8,a9            ;B8-15 dest pal, B0-7 color (0)
     735                    
     736 00002140     576b          clr     a11             ;For up fade
     737 00002150     4d4a          move    a10,a10
     738 00002160     c701          jrgt    bop20
     739 00002170     1beb          movk    31,a11          ;For dn fade
     740 00002180           bop20
     741                                                    ;Set up faded pal in process data space
     742 00002180     414b  boplp   add     a10,a11
     743 00002190     0b4b          cmpi    31,a11
         000021a0     ffe0  
     744 000021b0     c312          jrhi    bopx
     745 000021c0     4d62          move    a11,a2          ;A2=Brightness
TMS340 COFF Macro Assembler Version 6.10     Tue Dec 19 01:44:59 2023
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

palette allocator and fader control                                  PAGE   16

     746 000021d0     4da0          move    a13,a0
     747 000021e0     0b00          addi    PDATA,a0        ;A0=Dest Ram for Pal
         000021f0     0100  
     748 00002200     4c05          move    a0,a5
     749 00002210     4d01          move    a8,a1           ;A1=Src for Pal
     750 00002220     0d3f          callr   pal_addb
         00002230     002e  
     751                    
     752 00002240     4ca0          move    a5,a0           ;>Move faded palette to palram
     753 00002250     4d21          move    a9,a1
     754 00002260     9402          move    *a0+,a2         ;Get # colors in palette
     755 00002270     0d3f          callr   pal_set         ;Set transfer
         00002280     fe5a  
     756                    
     757 00002290                   SLEEPK  3
     758 000022d0     c0ea          jruc    boplp
     759                    
     760 000022e0           bopx    SLEEPK  1               ;give last xfer a chance to go
     761 00002320                   DIE
     762                    
     763                    
     764                    
     765 00002350            SUBR   addbrt_ae
     766                    
     767 00002350     576b          clr     a11             ;For up fade
     768 00002360     4d4a          move    a10,a10
     769 00002370     c701          jrgt    abae20
     770 00002380     1beb          movk    31,a11          ;For dn fade
     771 00002390           abae20
     772 00002390     414b  abaelp  add     a10,a11
     773 000023a0     0b4b          cmpi    31,a11
         000023b0     ffe0  
     774 000023c0     c308          jrhi    abaex
     775 000023d0     4d62          move    a11,a2          ;A2=Brightness
     776 000023e0     0d3f          callr   addbae
         000023f0     0008  
     777                    
     778 00002400                   SLEEPK  3
     779 00002440     c0f4          jruc    abaelp
     780                    
     781 00002450           abaex   DIE
     782                    
     783                    
     784                    
     785 00002480            SUBRP  addbae
     786                    
     787 00002480                   PUSH    a3,a5,a7,a8
     788                    
     789 000024a0     09e0          movi    IRQSKYE,a0
         000024b0 00000000! 
     790 000024d0     09e1          movi    irqskyeo,a1
         000024e0 00031260- 
     791 00002500     182e          movk    1,a14
     792 00002510     c006          jruc    pb1c
     793                    
TMS340 COFF Macro Assembler Version 6.10     Tue Dec 19 01:44:59 2023
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

palette allocator and fader control                                  PAGE   17

     794                    
     795                    
     796 00002520            SUBRP  pal_addb
     797                    
     798 00002520                   PUSH    a3,a5,a7,a8
     799                    
     800 00002540     942e          move    *a1+,a14        ;# Colors
     801 00002550     91c0          move    a14,*a0+
     802                    
     803 00002560     26ee          sll     23,a14          ;Remove any flags
     804 00002570     2d2e          srl     23,a14          ;9 bits needed for # colors
     805                    
     806 00002580     1be8  pb1c    movk    01fH,a8         ;A8=Mask for 5 bits of color
     807                    
     808 00002590     9423  pb100   move    *a1+,a3
     809 000025a0     1be7          movk    01fH,a7
     810 000025b0     5067          and     a3,a7           ;A7=Blue
     811 000025c0     2f63          srl     5,a3
     812 000025d0     1be5          movk    01fH,a5
     813 000025e0     5065          and     a3,a5           ;A5=Green
     814 000025f0     2f63          srl     5,a3            ;A3=Red
     815                    
     816 00002600     4043          add     a2,a3
     817 00002610     4045          add     a2,a5
     818 00002620     4047          add     a2,a7
     819                    
     820 00002630     4903          cmp     a8,a3
     821 00002640     c201          jrls    pbrok
     822 00002650     4d03          move    a8,a3
     823                    
     824 00002660     4905  pbrok   cmp     a8,a5
     825 00002670     c201          jrls    pbgok
     826 00002680     4d05          move    a8,a5
     827                    
     828 00002690     4907  pbgok   cmp     a8,a7
     829 000026a0     c201          jrls    pbbok
     830 000026b0     4d07          move    a8,a7
     831                    
     832 000026c0     2543  pbbok   sll     10,a3
     833 000026d0     24a5          sll     5,a5
     834 000026e0     54a3          or      a5,a3
     835 000026f0     54e3          or      a7,a3
     836 00002700     9060          move    a3,*a0+         ;Save color
     837 00002710     3f2e          dsj     a14,pb100
     838                    
     839 00002720                   PULL    a3,a5,a7,a8
     840 00002740     0960          rets
     841                    
     842                    
     843                    
     844 00002750            SUBR   fade_up
     845                    
     846 00002750     078a          move    a10,@fade_list,L
         00002760 00000030- 
     847                    
TMS340 COFF Macro Assembler Version 6.10     Tue Dec 19 01:44:59 2023
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

palette allocator and fader control                                  PAGE   18

     848 00002780     5600          clr     a0
     849 00002790     0580          move    a0,@fade_start
         000027a0 00000000- 
     850                    
     851 000027c0     09c0          movi    256,a0
         000027d0     0100  
     852 000027e0     0580          move    a0,@fade_end
         000027f0 00000010- 
     853                    
     854 00002810     4d60          move    a11,a0                  ;movk 8
     855 00002820     0580          move    a0,@fade_inc
         00002830 00000020- 
     856                    
     857 00002850     c034          jruc    do_fade
     858                    
     859                    
     860 00002860            SUBR   fade_down
     861                    
     862 00002860     078a          move    a10,@fade_list,L
         00002870 00000030- 
     863                    
     864 00002890     09c0          movi    256,a0
         000028a0     0100  
     865 000028b0     0580          move    a0,@fade_start
         000028c0 00000000- 
     866                    
     867 000028e0     5600          clr     a0
     868 000028f0     0580          move    a0,@fade_end
         00002900 00000010- 
     869                    
     870 00002920     058b          move    a11,@fade_inc
         00002930 00000020- 
     871                    
     872 00002950     c024          jruc    do_fade
     873                    
     874                    
     875 00002960            SUBR   fade_up_half
     876                    
     877 00002960     078a          move    a10,@fade_list,L
         00002970 00000030- 
     878                    
     879 00002990     09c0          movi    128,a0
         000029a0     0080  
     880 000029b0     0580          move    a0,@fade_start
         000029c0 00000000- 
     881                    
     882 000029e0     09c0          movi    256,a0
         000029f0     0100  
     883 00002a00     0580          move    a0,@fade_end
         00002a10 00000010- 
     884                    
     885 00002a30     1a00          movk    16,a0
     886 00002a40     0580          move    a0,@fade_inc
         00002a50 00000020- 
     887                    
TMS340 COFF Macro Assembler Version 6.10     Tue Dec 19 01:44:59 2023
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

palette allocator and fader control                                  PAGE   19

     888 00002a70     c012          jruc    do_fade
     889                    
     890                    
     891 00002a80            SUBR   fade_down_half
     892                    
     893 00002a80     078a          move    a10,@fade_list,L
         00002a90 00000030- 
     894                    
     895 00002ab0     09c0          movi    256,a0
         00002ac0     0100  
     896 00002ad0     0580          move    a0,@fade_start
         00002ae0 00000000- 
     897                    
     898 00002b00     09c0          movi    128,a0
         00002b10     0080  
     899 00002b20     0580          move    a0,@fade_end
         00002b30 00000010- 
     900                    
     901 00002b50     1a00          movk    16,a0
     902 00002b60     0580          move    a0,@fade_inc
         00002b70 00000020- 
     903                    
     904 00002b90     0300          jruc    do_fade
     905                    
     906                    
     907 00002ba0            SUBRP  do_fade
     908                    
     909 00002ba0     05a0          move    @IRQSKYE,a0
         00002bb0 00000000! 
     910 00002bd0     0580          move    a0,@irqskyeo
         00002be0 00031260- 
     911                    
     912 00002c00     05aa          move    @fade_start,a10
         00002c10 00000000- 
     913 00002c30           vdvcfade_loop
     914                    
     915 00002c30     05ab          move    @irqskyeo,a11
         00002c40 00031260- 
     916 00002c60     1be7          movk    01fH,a7
     917 00002c70     5167          and     a11,a7          ;A7  = Blue
     918 00002c80     2f6b          srl     5,a11
     919 00002c90     1be9          movk    01fH,a9
     920 00002ca0     5169          and     a11,a9          ;A9  = Green
     921 00002cb0     2f6b          srl     5,a11           ;A11 = Red
     922                    
     923 00002cc0     5f47          mpyu    a10,a7          ; X (0 - 32)
     924 00002cd0     2f07          srl     8,a7            ;/256
     925 00002ce0     5f49          mpyu    a10,a9
     926 00002cf0     2f09          srl     8,a9
     927 00002d00     5f4b          mpyu    a10,a11
     928 00002d10     2f0b          srl     8,a11
     929                    
     930 00002d20     254b          sll     10,a11          ;red
     931 00002d30     5567          or      a11,a7
     932 00002d40     24a9          sll     5,a9            ;green
TMS340 COFF Macro Assembler Version 6.10     Tue Dec 19 01:44:59 2023
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

palette allocator and fader control                                  PAGE   20

     933 00002d50     5527          or      a9,a7
     934                    
     935 00002d60     0587          move    a7,@IRQSKYE
         00002d70 00000000! 
     936                    
     937                    
     938 00002d90     09e4          movi    FADERAM,a4
         00002da0 00001250- 
     939 00002dc0     09e1          movi    PALRAM,a1
         00002dd0 00000050- 
     940 00002df0     09c3          movi    NUMPAL,a3
         00002e00     0030  
     941 00002e10           vdvcnext_pal
     942 00002e10     9622          move    *a1+,a2,L       ;Get *palette
     943 00002e20     ca2b          jrz     vdvcempty_pal
     944                    
     945 00002e30     07a7          move    @fade_list,a7,L
         00002e40 00000030- 
     946 00002e60     ca05          jrz     vdvcskip_check
     947 00002e70     c002          jruc    vdvcstart
     948                    
     949 00002e80           vdvcnext_check
     950 00002e80     4922          cmp     a9,a2
     951 00002e90     ca24          jreq    vdvcdone                ;skip this palette
     952 00002ea0           vdvcstart
     953 00002ea0     96e9          move    *a7+,a9,L
     954 00002eb0     cbfc          jrnz    vdvcnext_check
     955                    
     956 00002ec0           vdvcskip_check
     957                    
     958 00002ec0     9445          move    *a2+,a5         ;Number colours in palette
     959 00002ed0     4ca8          move    a5,a8
     960 00002ee0     4c86          move    a4,a6
     961                    
     962 00002ef0           vdvccopy_loop
     963 00002ef0     944b          move    *a2+,a11
     964 00002f00     1be7          movk    01fH,a7
     965 00002f10     5167          and     a11,a7          ;A7  = Blue
     966 00002f20     2f6b          srl     5,a11
     967 00002f30     1be9          movk    01fH,a9
     968 00002f40     5169          and     a11,a9          ;A9  = Green
     969 00002f50     2f6b          srl     5,a11           ;A11 = Red
     970                    
     971 00002f60     5f47          mpyu    a10,a7          ; X (0 - 32)
     972 00002f70     2f07          srl     8,a7            ;/256
     973 00002f80     5f49          mpyu    a10,a9
     974 00002f90     2f09          srl     8,a9
     975 00002fa0     5f4b          mpyu    a10,a11
     976 00002fb0     2f0b          srl     8,a11
     977                    
     978 00002fc0     254b          sll     10,a11          ;red
     979 00002fd0     5567          or      a11,a7
     980 00002fe0     24a9          sll     5,a9            ;green
     981 00002ff0     5527          or      a9,a7
     982                    
TMS340 COFF Macro Assembler Version 6.10     Tue Dec 19 01:44:59 2023
 Copyright (c) 1985-1991  Texas Instruments Incorporated 

palette allocator and fader control                                  PAGE   21

     983 00003000     90e6          move    a7,*a6+         ;1 word
     984                    
     985 00003010     3e68          dsj     a8,vdvccopy_loop
     986                    
     987                    
     988 00003020                   PUSH    a1,a2
     989 00003040     4c80          move    a4,a0           ;* colour data
     990 00003050     09c1          movi    NUMPAL,a1
         00003060     0030  
     991 00003070     4461          sub     a3,a1           ;dest palette ( 0 - NUMPAL-1 )
     992 00003080     2501          sll     8,a1            ;
     993 00003090     4ca2          move    a5,a2           ;# colours
     994 000030a0     0d3f          callr   pal_set
         000030b0     fd77  
     995 000030c0                   PULL    a1,a2
     996 000030e0           vdvcdone
     997 000030e0           vdvcempty_pal
     998 000030e0     0b04          addi    FPALSZ,a4
         000030f0     1000  
     999 00003100     0d83          dsj     a3,vdvcnext_pal
         00003110     ffcf  
    1000                    
    1001 00003120                   SLEEPK  1
    1002                    
    1003 00003160     05a0          move    @fade_start,a0
         00003170 00000000- 
    1004 00003190     05a1          move    @fade_end,a1
         000031a0 00000010- 
    1005 000031c0     4801          cmp     a0,a1
    1006 000031d0     c309          jrhi    vdvcfading_up
    1007                                                    ;fading_down
    1008 000031e0     05a0          move    @fade_inc,a0    ;signed inc
         000031f0 00000020- 
    1009 00003210     440a          sub     a0,a10
    1010 00003220     482a          cmp     a1,a10
    1011 00003230     c59f          jrge    vdvcfade_loop
    1012                    
    1013 00003240                   DIE
    1014                    
    1015 00003270           vdvcfading_up
    1016 00003270     05a0          move    @fade_inc,a0    ;signed inc
         00003280 00000020- 
    1017 000032a0     400a          add     a0,a10
    1018 000032b0     482a          cmp     a1,a10
    1019 000032c0     c296          jrls    vdvcfade_loop
    1020                    
    1021 000032d0                   DIE
    1022                    
    1023                    
    1024                            .end

 No Errors,  No Warnings
